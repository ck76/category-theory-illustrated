---
layout: default
title: 伴随 (Adjunctions)
---

伴随 (Adjunctions)
===

在本章中，我们将继续前两章中发展的这个*主旋律*，即通过引入新的范畴之间的等价关系来开始每一章（并且每一种新的等价关系比前一种更为宽松）。

我们从关于函子 (functors) 的章节开始，回顾了*范畴同构* (categorical isomorphisms)，这是一种在范畴之间可逆的函数。

然后在关于*自然变换* (natural transformations) 的章节中，我们看到了在同构意义下等价的范畴。

现在我们将进一步放宽条件，回顾一种既不是完全等价但也不是完全不等价的关系。这种关系不是完全的双向，但同时也不是完全的单向。它被称为*伴随* (adjunction)。

如你所见，我不太擅长解释这个概念，因此我准备了一些例子。但在进行这些例子之前，我们先来看一些其他的内容。

{% if site.distribution == 'print' %}

自由函子与遗忘函子 (Free and Forgetful Functors)
===

$Cat$ 范畴中的许多范畴是基于彼此构建的，即一个范畴是另一个范畴加上一些额外的法则——例如，群 (groups) 是具有逆元 (inversion) 的幺半群 (monoids)，偏序 (partial orders) 是反对称的预序 (antisymmetric preorders)。实际上，几乎所有范畴都可以看作是具有附加态射 (morphisms) 的集合 (sets)。在这类范畴之间存在两个函子，一个是从丰富的范畴映射到较为简单的范畴的*遗忘函子* (forgetful functor)，另一个则是从较简单范畴映射到较复杂范畴的*自由函子* (free functor)。

![自由函子与遗忘函子](free_forgetful_functors.svg)

### 遗忘函子 (Forgetful Functors)
===

遗忘函子将较为复杂、具有更多结构的范畴中的对象映射到相应的较为简单、结构较少的范畴中的对象。

![遗忘函子](forgetful_functors.svg)

它会去除（遗忘）较复杂范畴中那些在较简单范畴中不存在的所有结构。

#### 对象映射 (Object Mapping)
---

遗忘函子的对象映射由选择对应于较复杂范畴中对象的较简单范畴中的对象组成。它的工作方式是移除较复杂范畴中每个对象的附加结构或属性，这些结构或属性在较简单范畴中不存在。

以集合范畴 $Set$ 和幺半群范畴 $Mon$ 之间的遗忘函子为例。幺半群是一个集合，结合了*幺半群运算*。幺半群运算就是额外的结构。如果我们去掉它，幺半群剩下的就是其底层的集合。这一观察定义了从幺半群范畴到集合范畴的遗忘函子的对象映射——每个幺半群映射到其底层集合。

![遗忘函子的对象映射](forgetful_functor_objects.svg)

这种类型的函子存在于基于彼此的任何两个范畴之间。只有在这样的函子存在时，两个范畴才被认为是基于彼此的。

#### 态射映射 (Morphism Mapping)
---

为了使遗忘函子真正成为函子，它还必须在两个范畴之间映射态射，也就是说，必须将每个*幺半群同态* (monoid homomorphism) 映射为它们底层集合之间的函数。

这并不难——我们说过幺半群同态是其底层集合之间的函数，并且该函数保持群运算。这意味着它们实际上是*底层集合之间的函数*。因此，我们所要做的就是忘记这些额外的条件。

#### 函子定律 (Functor Laws)
---

由于我们基本上是将一个范畴的结构复制到另一个范畴，因此函子定律显然得以遵守。

### 自由函子 (Free Functors)
===

现在让我们回顾与遗忘函子相关，但方向相反的函子——从较简单范畴到较复杂范畴的函子。

![自由函子](free_functors.svg)

说“方向相反”实际上并不完全准确，因为我们不能简单地反转遗忘函子的映射。这是因为，给定一个简单的结构（例如一个集合），可能对应多个较复杂的结构（例如，整数集可以是自然数在加法下形成的幺半群，也可以是自然数在乘法下形成的幺半群）。

尽管如此，我们仍有一个与其存在有趣关系的函子——这个函子被称为给定范畴的*自由函子*。它通过将较简单范畴中的每个对象连接到与其对应的*自由对象*来工作。在我们的例子中，自由对象是由给定集合生成的自由幺半群。

#### 对象映射 (Object Mapping)
---

自由函子的对象映射是生成*自由对象*的过程。对于较简单范畴中的任一对象 $o$，$F(o)$ 是较复杂范畴中的对象，它为 $o$ 添加了使其成为较复杂范畴对象所需的最小结构。

这一概念比较复杂，因此我们以自由幺半群为例。在我们回顾它们时（在第三章），我们提到给定集合的自由幺半群是“什么也不做”的幺半群，即没有规则的幺半群。

这意味着什么？我们说每个幺半群可以由一组基本元素表示，称为生成元 (generators)（例如，直角三角形的60度旋转）。

![旋转生成元](generator_rotations.svg)

还有一组规则或方程描述了这些生成元的序列如何缩减为单个元素（例如，旋转三角形三次使其回到初始位置的规则）。

![旋转规则](rule_rotations.svg)

在这里，给定一组生成元的规则可以是任意的，因此自由幺半群是没有这些规则的幺半群。结果是，给定集合的自由幺半群是由该集合的所有可能（无穷）序列组成的幺半群（该集合被视为幺半群的生成元集合）。

如果你仔细思考这一定义，就会意识到自由幺半群实际上就是我们在编程中熟悉的*列表数据类型*。并且将集合转换为幺半群的自由函子实际上就是我们在前一章节中看到的列表函子。

![自由函子](free_functor_objects.svg)

形式上，集合 $A$ 上的自由幺半群就是类型 $[A]$，自由函子是 $a \to [a]$，其中 $a:A$。

#### 态射映射 (Morphism Mapping)
---

一旦我们确定了集合 $A$ 的自由函子就是列表函子，我们就已经知道了如何构建将集合之间的函数转换为这些集合的列表之间的函数的映射，而构建此映射的方法是将该函数应用于列表中的每个元素。

### 伴随函子 (Adjoint Functors)
===

如果自由对象及其对应的自由函子的概念对你来说显得有些随意，不要担心，一旦我们明确它与（可以说更直接的）遗忘函子的关系后，它会变得更加清晰。

这种关系有些复杂——解释它涉及三个步骤。

第一步：给定一个自由对象（在我们的例子中是由一组生成元生成的自由幺半群），存在从该自由幺半群到由相同生成元组成的其他幺半群的幺半群同态。该同态仅通过应用幺半群法则来完成，将自由幺半群的每个元素转换为另一个幺半群的元素。

例如，通过应用颜色混合规则，我们可以将由红色、蓝色和黄色球组成的自由幺半群的任何元素转换为颜色混合幺半群的元素。

![伴随](adjunction_1.svg)

第二步：存在从任何集合到由该集合的元素作为生成元生成的幺半群的底层集合的态射。

![伴随](adjunction_2.svg)

最后，这两个函数集之间存在同构，这反过来又转化为自由函子和遗忘函子之间的关系，如下图所示（自由函子用绿色表示，遗忘函子用红色表示）。

![伴随](adjunction_3.svg)

你可以看到，这种关系被称为*伴随* (adjunction)，它定义了自由函子与遗忘函子的关系，反之亦然。

### 单位与共单位 (Unit and Counit)
---

### 另一个例子 (Another Example)
---

让我们看另一个例子。仅包含一个生成元对象的自由幺半群（在我们的例子中是 $1$）可以映射到所有循环幺半群（如 $Z_1$、$Z_2$、$Z_3$ 等），以及自然数在加法下形成的幺半群，如下图所示。

![伴随](adjunction_numbers_1.svg)

在集合范畴中，存在从单元素集合到包含该元素的任意集合的函数。

![伴随](adjunction_numbers_2.svg)

这两个函数的等价实际上是由自由函子和遗忘函子构建的集合与幺半群之间的伴随关系的另一个实例。

![伴随](adjunction_numbers.svg)

关于自由函子和遗忘函子以及伴随函子，还有很多可以讨论的内容，但正如往常一样，我会在最有趣的时刻停下来，以便稍后从不同的角度重新审视它们。

{% endif %}

伴随 (Adjunction) 和等价 (Equivalence) 一样，是范畴之间的关系。伴随由两个函子组成，类似于等价关系。

然而，与等价不同，伴随关系并非对称，即尽管这两个函子是双向的...

$F \bullet G \cong  id_{D}$

$G \bullet F \cong  id_{C}$

$F \bullet G \to id_{D}$

$G \bullet F \to id_{C}$

### 自由-遗忘伴随 (Free-Forgetful Adjunctions)
===

### 形式概念分析 (Formal Concept Analysis)
===

### 张量-同态伴随 (Tensor-Hom Adjunction)
===

张量-同态伴随实际上是我们之前看到的柯里化 (currying) 和逆柯里化 (uncurrying) 的别名。

Adjunctions
===

https://hackmd.io/@alexhkurz/HyMzQZLJu

https://hackmd.io/@alexhkurz/H1OxumxRP

https://github.com/adamnemecek/adjoint/

https://chrispenner.ca/posts/adjunction-battleship

https://graphicallinearalgebra.net/2015/05/19/paths-and-matrices-part-1/
